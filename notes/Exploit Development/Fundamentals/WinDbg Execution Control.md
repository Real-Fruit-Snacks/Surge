---
tags:
  - Advanced
  - Binary_Exploitation
  - Debugging
  - Exploitation
  - WinDbg
  - Windows
---

## WinDbg Execution Control
resources: [WinDbg Breakpoints](https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/setting-breakpoints)

> Control program execution with breakpoints, stepping, and conditional breaks.

### Software Breakpoints
> Set breakpoints to pause execution at specific addresses.

```text
bp <Address>                ; Set breakpoint at address
bp kernel32!CreateFileA     ; Break on API function
bp 0x00401000               ; Break at specific address
bp mymodule!main            ; Break at function in module
```

### List Breakpoints
> View all currently set breakpoints.

```text
bl                          ; List all breakpoints
```

### Enable/Disable Breakpoints
> Toggle breakpoints without removing them.

```text
bd <Number>                 ; Disable breakpoint
be <Number>                 ; Enable breakpoint
bd *                        ; Disable all breakpoints
be *                        ; Enable all breakpoints
```

### Remove Breakpoints
> Delete breakpoints from the breakpoint list.

```text
bc <Number>                 ; Clear specific breakpoint
bc *                        ; Clear all breakpoints
```

### Unresolved Function Breakpoints
> Set breakpoints on functions in modules not yet loaded.

```text
bu <Module>!<Function>      ; Breakpoint unresolved
bu mymodule!vulnerable_func
```

> [!tip] **bu** breakpoints persist across module loads and are set when the module loads.

### Conditional Breakpoints
> Break only when conditions are met.

```text
bp <Address> ".if (eax == 0x41414141) {} .else {gc}"
bp kernel32!CreateFileA ".if (poi(esp+4) == 0x00401000) {} .else {gc}"
```

### Breakpoint Actions
> Execute commands when breakpoint hits.

```text
bp <Address> "dd esp L4; g"              ; Dump stack and continue
bp <Address> "r; .echo 'Hit!'; g"        ; Show registers, print message, continue
bp kernel32!recv "dd esp L5; db poi(esp+8) L10; g"   ; Dump recv params
```

### Hardware Breakpoints
> Use CPU debug registers for breakpoints (limited to 4).

```text
ba e 1 <Address>            ; Break on execute (1 byte)
ba r 4 <Address>            ; Break on read (4 bytes)
ba w 4 <Address>            ; Break on write (4 bytes)
```

> [!info] **e** = execute, **r** = read, **w** = write. Size can be 1, 2, or 4 bytes.

### Hardware Breakpoint Examples
> Common hardware breakpoint patterns.

```text
ba w 4 0x00403000           ; Break when address is written
ba r 4 esp                  ; Break when ESP is read (unusual)
ba e 1 0x00401050           ; Break on execute (like bp but uses HW)
```

### List Hardware Breakpoints
> Hardware breakpoints appear in breakpoint list.

```text
bl                          ; Shows both software and hardware BPs
```

### Stepping Through Code
> Execute code one instruction at a time.

```text
p                           ; Step over (execute call as single step)
t                           ; Step into (trace into calls)
pt                          ; Step to next return
pc                          ; Step to next call
pa <Address>                ; Step to address
```

### Continue Execution
> Resume program execution.

```text
g                           ; Go (continue execution)
gc                          ; Go from conditional breakpoint
gh                          ; Go with exception handled
gn                          ; Go with exception not handled
gu                          ; Go up (execute until return)
```

### Run to Address
> Execute until reaching a specific address.

```text
g <Address>                 ; Run until address
g 0x00401050                ; Run until specific address
g @$ra                      ; Run until return address
```

### Exception Handling
> Control how debugger handles exceptions.

```text
sxe <Exception>             ; Stop on first chance exception
sxd <Exception>             ; Ignore first chance, stop on second
sxi <Exception>             ; Ignore exception completely
sxn <Exception>             ; Notify but don't stop
```

### Common Exception Settings
> Configure handling for common exceptions.

```text
sxe av                      ; Stop on access violation (first chance)
sxd av                      ; Pass first chance AV to program
sxe ld:<Module>             ; Stop when module loads
```

